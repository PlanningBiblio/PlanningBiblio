{# notifications/index.html.twig #}

{% extends 'base.html.twig' %}

{% block page %}
  <form name='form2' action='index.php' method='get'>
    <input type='hidden' name='page' value='notifications/index.php' />
    <table style='margin-bottom:10px;'>
      <tr style='vertical-align:center;'>
        <td style='width:370px;'>
          <h3 style='margin:0;'>Validations des absences et notifications</h3>
        </td>
        <td>
          Voir les agents
        </td>
        <td style='width:150px;'>
          <select name='actif' onchange='document.form2.submit();' class='ui-widget-content ui-corner-all'>
            <option value='Actif' <?php echo $option1; ?> >Service public</option>
            <option value='Inactif' <?php echo $option2; ?> >Administratif</option>
          </select>
        </td>
      </tr>
    </table> 
  </form>
  <form name='form' method='post' action='index.php' onsubmit='return confirm(\"Etes vous sûr de vouloir supprimer les agents sélectionnés ?\");'>
    <table id='tableAgents' class='CJDataTable' data-sort='[[1,\"asc\"],[2,\"asc\"]]' >
      <thead>
      <tr>
        <th class='dataTableNoSort aLeft' ><input type='checkbox' class='CJCheckAll'/></th>
        <th>Nom</th>
        <th>Prénom</th>
        <th>Service</th>
        <th>Statut</th>
        {% if config('Multisites-nombre') > 1 %}
          <th>Sites</th>
        {% endif %}
        <th>Validations / notifications</th>
      </thead>
      <tbody>
        {% for agent in agents %}
          <tr>
            <td style='white-space:nowrap;'>
              <input type='checkbox' name='chk{{loop.index0}}' value='$id' class='checkboxes'/>
              <span class='pl-icon pl-icon-edit pointer' title='Modifier' data-id='{{ agent.id }}'></span>";
            </td>
            <td>{{ agent.nom }}</td>
            <td>{{ agent.prenom }}</td>
            <td>{{ agent.service }}</td>
            <td>{{ agent.statut }}</td>
            {% if config('Multisites-nombre')>1 %}
                <td>{{ agent.sites_list }}</td>
            {% endif %}
            {% if not agent.responsables_list is empty %}
                <td>{{ agent.responsables_list }}</td>
            {% else %}
                <td>&nbsp;</td>
            {% endif %}
          </tr>
        {% endfor %}
      </tbody>
    </table>
    <input type='hidden' name='CSRFToken' id='CSRFToken' value="{{ CSRFToken }}" />
    <input type='button' value='Modifier la sélection' class='ui-button' id='update-button' />
  </form>

  <div id="update-form" title="Validations / Notifications" class='noprint' style='display:none;'>
    <p class="validateTips" style='text-align:justify;'>Choisissez les responsables qui ont le droit de valider les absences et congés des agents sélectionnés.<br/>Cochez la case s'ils doivent être notifiés lors de l'enregistrement d'une nouvelle absence ou demande de congés.</p>
    <form>
      <table class='tableauFiches'>
        <thead style='text-align: left;'>
          <tr>
            <th style='padding-bottom:10px;'>Responsables</th>
            <th style='padding-bottom:10px;'>Notifications</th>
          </tr>
        </thead>
        <tbody>
          {% for i in 0..5 %}
            <tr>
              <td>
                <select name='responsable-{{i}}' id='responsable-{{i}}' class='responsables' data-id='{{i}}'>
                  <option value=''>&nbsp;</option>
                  foreach ($agents_responsables as $agent) {
                      echo "<option value='{$agent['id']}'>{$agent['nom']} {$agent['prenom']}</option>\n";
                  }
                </select>
              </td>
              <td>
                <input type='checkbox' name='notification-{{i}}' id='notification-{{i}}' class='notifications' data-id='{{i}}'/>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </form>
  </div>
{% endblock %}