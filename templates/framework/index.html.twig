{# templates/framework/index.html.twig #}
{% extends 'base.html.twig' %}

{% block specificjs %}
  <script type="text/JavaScript" src='{{ asset("js/plb/framework.js") }}'></script>
  <script type="text/JavaScript">
    $(document).ready(function(){
      $("#copy-div").dialog({
          autoOpen: false,
          modal: true,
          width: 400,
          height: 310
      });

      $('.copy-table').click(function(e){
        e.preventDefault();
        id = $(this).data('id');
        $("#copy-div").dialog('open');
        $("#copy-form").attr("action", url('framework/copy/' + id));
        $("#copy-form#numero").attr("value", id);

      });

      $("#Copy").on('click', function(e){
        $("#copy-form").submit();
        e.preventDefault();
        $("#copy-div").html("<br/><br/><b>Copie en cours. Veuillez patienter ...</b>");
        $(this).unbind(e).click();
      });
    });
  </script>
{% endblock %}

{% block page %}
  <h3>Gestion des tableaux</h3>
  <div id='tableaux-listes' class='tableaux-cfg'>
    <h4>Liste des tableaux</h4>
    <p>
      <a href="{{ asset('framework/add') }}" class='ui-button ui-button-type2'>Nouveau tableau</a>
    </p>
    <form name='form' method='get' action='{{ asset("framework")}}'>
      <input type="hidden" name="modification" value ="tableau"/>
      <table class='CJDataTable' id='table-list' data-noExport='1' data-sort='[[1,"asc"]]'>
        <thead>
          <tr>
            <th class='dataTableNoSort'>
              <input type='checkbox' class='CJCheckAll' />
            </th>
            <th>Nom</th>
            {% if nbSites > 1 %}
              <th>Site</th>
            {% endif %}
            <th class='dataTableDateFR'>Dernière utilisation</th>
          </tr>
        </thead>
        <tbody>
          {% for framework in frameworks %}
            <tr id='tr-tableau-{{ framework.tableau }}' >
              <td style='white-space:nowrap;'>
                <input type='checkbox' name='chk{{ loop.index0 }}' value='{{ framework.tableau }}' class='chk1'/>
                <input type='hidden' name='numero' id='numero' value ="{{ framework.tableau }}" />
                <a href="{{ asset('framework') }}/{{ framework.tableau }}">
                  <span class='pl-icon pl-icon-edit' title='Modifier'></span>
                </a>
                <a href="" class="copy-table" data-id ="{{ framework.tableau }}">
                  <span class='pl-icon pl-icon-copy' id="copy-tab-link{{ framework.tableau }}" title='Copier' style="border: none;"></span>
                </a>
                <a href='javascript:supprimeTableau({{ framework.tableau }});'>
                  <span class='pl-icon pl-icon-dropblack' title='Supprimer'></span>
                </a>
              </td>
              <td id='td-tableau-{{ framework.tableau }}-nom'>{{ framework.nom | raw }}</td>
              {% if nbSites > 1 %}
                <td>{{ framework.siteName }}
              {% endif %}
              <td>{{ framework.assignment }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </form>
    <p>
      <input type='button' value='Supprimer la sélection' class='ui-button ui-button-type3' onclick="supprime_select('chk1','{{ asset("framework-batch_delete") }}');">
    </p>
    {% if deletedFrameworks is not empty %}
      <p style='margin-top:30px;'>
        Récupération d'un tableau supprimé
        <select id='tableauxSupprimes'>
          <option value=''>&nbsp;</option>
            {% for framework in deletedFrameworks %}
              <option value='{{ framework.tableau }}'>{{ framework.nom }} (utilisation : {{ framework.assignment }})</option>
            {% endfor %}
        </select>
      </p>
    {% endif %}
  </div>
  <div id='tableaux-groupes' class='tableaux-cfg' >
    <h4>Groupes</h4>
    <p>
      <input type='button' value='Nouveau groupe' class='ui-button ui-button-type2' onclick="location.href='{{ asset("framework-group/add") }}';" />
    </p>
    <table class='CJDataTable' id='table-groups' data-noExport='1' data-sort='[[1,"asc"]]'>
      <thead>
        <tr>
          <th class='dataTableNoSort'>&nbsp;</th>
          <th>Nom</th>
          {% if nbSites > 1 %}
            <th>Site</th>
          {% endif %}
        </tr>
      </thead>
      <tbody>
        {% if groupes is iterable %}
          {% for groupe in groupes %}
            <tr id='tr-groupe-{{ groupe.id }}'>
              <td>
                <a href="{{ asset('framework-group') }}/{{ groupe.id }}">
                  <span class='pl-icon pl-icon-edit' title='Modifier'></span>
                </a>
                <a href='javascript:supprimeGroupe({{ groupe.id }});'>
                  <span class='pl-icon pl-icon-dropblack' title='Supprimer'></span>
                </a>
              </td>
              <td id='td-groupe-{{ groupe.id }}-nom'>{{ groupe.nom | raw }}</td>
              {% if nbSites > 1 %}
                <td>{{ groupe.multisite }} </td>
              {% endif %}
            </tr>
          {% endfor %}
        {% endif %}
      </tbody>
    </table>
  </div>
  <div id='tableaux-separations' class='tableaux-cfg'>
    <h4>Lignes de séparation</h4>
    <p>
      <input type='submit' value='Nouvelle ligne' class='ui-button ui-button-type2' onclick='location.href="{{ asset('framework-line/add') }}";'/>
    </p>
    <table class='CJDataTable' id='table-separations' data-noExport='1'  data-sort='[[1, "asc"]]'>
      <thead>
        <tr>
          <th class='dataTableNoSort'>&nbsp;</th>
          <th>Nom</th>
        </tr>
      </thead>
      <tbody>
        {% if lignes %}
          {% for elem in lignes %}
            <tr id='tr-ligne-{{ elem.id }}' >
              <td>
                <a href="{{ asset('framework-line') }}/{{ elem.id }}">
                  <span class='pl-icon pl-icon-edit' title='Modifier'></span>
                </a>
                {% if elem.delete == true %}
                  <a href='javascript:supprimeLigne({{ elem.id }});'>
                    <span class='pl-icon pl-icon-dropblack' title='Supprimer'></span>
                  </a>
                {% endif %}
              </td>
              <td id='td-ligne-{{ elem.id }}-nom' >{{ elem.nom | raw }}</td>
            </tr>
          {% endfor %}
        {% endif %}
      </tbody>
    </table>
  </div>

  <div id="copy-div" style="display: none;">
    <h3>Copie du tableau</h3>
    <form name="form" id="copy-form" action="" method="post">
      <input type="hidden" name="_token" value="{{ csrf_token('') }}" />
      <input type='hidden' name='menu' value='off' />
      <input type='hidden' name='numero' id='numero' value="" />
      Nom du nouveau tableau<br/>
      <input type='text' name='nom' />
      <br/><br/><br/>
      <input type='button' id="Cancel" value='Annuler' onclick="$('#copy-div').dialog('close');" class="ui-button ui-button-type2"/>
      &nbsp;&nbsp;<input type='button' id="Copy" value='Copier' class="ui-button ui-button-type1"/>
    </form>
  </div>
{% endblock %}
