{# admin/model/index.html.twig #}

{% extends 'base.html.twig' %}

{% block specificjs %}
  <script type='text/JavaScript'>
    function delete_template(id, statedweek) {
      if (confirm("Etes vous sûr de vouloir supprimer cet élément ?")) {
        url = '/model/' + id;
        if (statedweek == true) {
          url = '/statedweekmodel/' + id;
        }
        $.ajax({
          url: url,
          type: "DEL",
          success: function(data) {
            window.location.reload(false);
          },
          error: function() {
            CJInfo("Une erreur est survenue lors de la suppression","error");
          }
        });
      }
    }
  </script>
{% endblock %}

{% block page %}
    <h3>Modèles</h3>

    {% if models or statedweek_templates %}
      <table id='tableModeles' class='CJDataTable' data-sort='[[1]]'>
        <thead>
          <tr>
            <th class='dataTableNoSort tableSort'>&nbsp;</th>
            <th class="tableSort">Nom</th>
            <th class="tableSort">Type</th>
            {% if multi_sites %}
                <th class="tableSort">Site</th>
            {% endif %}
          </tr>
        </thead>
        <tbody>
          {% for model in models %}
            <tr>
              <td>
                <a href='{{ asset("/model/") }}{{ model.id }}'><span class='pl-icon pl-icon-edit' title='Modifier'></span></a>
                <a href='javascript:delete_template({{ model.id }});'><span class='pl-icon pl-icon-dropblack' title='Supprimer'></span></a>
              </td>

        <div class="tableaux-cfg">
          <h3>Modèles de planning</h3>
          <table id='tableModeles' class='CJDataTable' data-sort='[[1]]'>
              <thead>
                <tr>
                  <th class='dataTableNoSort'>&nbsp;</th>
                  <th>Nom</th>
                  <th>Type</th>
                  {% if multi_sites %}
                    <th>Site</th>
                  {% endif %}
                </tr>
              </thead>
              <tbody>
                {% for name,model in models %}
                  <tr>
                    <td>
                      <a href='{{ asset("/model/") }}{{ model.id }}'><span class='pl-icon pl-icon-edit' title='Modifier'></span></a>
                      <a href='javascript:delete_template({{ model.id }});'><span class='pl-icon pl-icon-drop' title='Supprimer'></span></a>
                    </td>

                    <td>
                      {{ name }}
                    </td>
                    <td>
                    {% if model.week %}
                      Semaine
                    {% else %}
                      Jour
                    {% endif %}
                    </td>
                    {% if multi_sites %}
                      <td>
                        {{ sites[model.site] }}
                      </td>
                    {% endif %}

                    </td>
                  </tr>
                {% endfor %}
              </tbody>
          </table>
        </div>

        <div class="tableaux-cfg">
          <h3>Modèles de planning semaines fixes</h3>
          <table id='tableStatedweekTemplate' class='CJDataTable' data-sort='[[1]]'>
              <thead>
                <tr>
                  <th class='dataTableNoSort'>&nbsp;</th>
                  <th>Nom</th>
                  <th>Type</th>
                </tr>
              </thead>
              <tbody>
                {% for t in statedweek_templates %}
                  <tr>
                    <td>
                      <a href='{{ asset("/statedweekmodel/") }}{{ t.id }}'><span class='pl-icon pl-icon-edit' title='Modifier'></span></a>
                      <a href='javascript:delete_template({{ t.id }}, true);'><span class='pl-icon pl-icon-drop' title='Supprimer'></span></a>
                    </td>

                    <td>
                      {{ t.name }}
                    </td>
                    <td>
                    {% if t.type == 'week' %}
                      Semaine
                    {% else %}
                      Jour
                    {% endif %}
                    </td>
                  </tr>
                {% endfor %}
              </tbody>
          </table>
        </div>
    {% else %}
      <p>Aucun modèle enregistré</p>
    {% endif %}
{% endblock %}
